<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Penjana Latihan Pendidikan Moral (Tahun 1, 2 & 3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #f0f9ff;
            -webkit-tap-highlight-color: transparent;
        }
        button, select { touch-action: manipulation; }
        .comic-font { font-family: 'Comic Neue', cursive; }
        .loader {
            border: 5px solid #e5e7eb;
            border-top: 5px solid #ec4899;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Interactive Classes */
        .option-correct { background-color: #dcfce7 !important; border-color: #22c55e !important; }
        .option-wrong { background-color: #fee2e2 !important; border-color: #ef4444 !important; }
        .option-disabled { pointer-events: none; opacity: 0.8; }
    </style>
</head>
<body class="text-gray-800 pb-20 md:pb-0">

    <!-- Header / Control Panel -->
    <div class="bg-white shadow-lg sticky top-0 z-40 border-b-4 border-indigo-500" id="main-header">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <h1 class="text-xl md:text-2xl font-bold text-indigo-800 comic-font">üé® Penjana Moral Interaktif</h1>
                    <p class="text-xs text-gray-500">Tahun 1, 2 & 3 ‚Ä¢ DSKP Semakan 2017</p>
                </div>
                
                <div class="w-full md:w-auto flex flex-col gap-2">
                    <div class="flex gap-2">
                        <!-- Year Selector -->
                        <select id="yearSelector" class="flex-1 bg-white border-2 border-indigo-200 text-indigo-900 text-sm rounded-lg p-2 font-bold focus:ring-indigo-500">
                            <option value="1">Tahun 1</option>
                            <option value="2">Tahun 2</option>
                            <option value="3">Tahun 3</option>
                        </select>
                        <!-- Unit Selector -->
                        <select id="unitSelector" class="flex-[2] bg-white border-2 border-indigo-200 text-indigo-900 text-sm rounded-lg p-2 font-bold focus:ring-indigo-500">
                            <option value="1">Unit 1: Kepercayaan Kepada Tuhan</option>
                            <option value="2">Unit 2: Baik Hati</option>
                            <option value="3">Unit 3: Bertanggungjawab</option>
                            <option value="4">Unit 4: Berterima Kasih</option>
                            <option value="5">Unit 5: Hemah Tinggi</option>
                            <option value="6">Unit 6: Hormat</option>
                            <option value="7">Unit 7: Kasih Sayang</option>
                            <option value="8">Unit 8: Keadilan</option>
                            <option value="9">Unit 9: Keberanian</option>
                            <option value="10">Unit 10: Kejujuran</option>
                            <option value="11">Unit 11: Rajin</option>
                            <option value="12">Unit 12: Kerjasama</option>
                            <option value="13">Unit 13: Kesederhanaan</option>
                            <option value="14">Unit 14: Toleransi</option>
                        </select>
                    </div>

                    <div class="flex gap-2 w-full">
                        <button onclick="generatePaper()" class="flex-1 flex items-center justify-center gap-2 bg-pink-500 hover:bg-pink-600 text-white px-4 py-2.5 rounded-xl font-bold transition shadow-md active:scale-95 text-sm">
                            <span>‚ú® Jana Latihan</span>
                        </button>
                        <button onclick="openPrintWindow()" class="flex-1 flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2.5 rounded-xl font-bold transition shadow-md active:scale-95 text-sm">
                            <span>üñ®Ô∏è Cetak</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container mx-auto px-4 py-6 max-w-5xl" id="main-content">
        
        <div id="stats-bar" class="hidden mb-6 bg-indigo-600 text-white p-4 rounded-2xl flex justify-between items-center shadow-md">
            <span class="font-bold">Skor Anda: <span id="current-score">0</span> / 25</span>
            <span id="completion-text" class="text-xs bg-indigo-500 px-3 py-1 rounded-full">Klik jawapan untuk semak!</span>
        </div>

        <div id="loading" class="hidden flex flex-col items-center justify-center py-20 bg-white rounded-xl shadow-sm mx-4">
            <div class="loader mb-4"></div>
            <p class="text-indigo-600 font-bold animate-pulse text-center">Menjana soalan interaktif...<br><span class="text-xs text-gray-400 font-normal">Sila tunggu sebentar</span></p>
        </div>

        <div id="questions-list" class="grid gap-6 md:grid-cols-1"></div>

        <!-- Hidden Templates for Printing -->
        <div id="print-header-template" class="hidden">
            <div class="mb-6 border-b-2 border-black pb-4 text-black">
                <div class="text-center mb-6">
                    <h1 class="text-2xl font-bold uppercase">LATIHAN PENDIDIKAN MORAL</h1>
                    <p class="text-sm font-bold mt-1 print-subtitle-target">TAJUK: UNIT X</p>
                    <p class="text-sm print-year-target">TAHUN: X</p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm font-semibold border border-black p-4">
                    <div class="py-2">Nama: __________________________________________</div>
                    <div class="py-2">Kelas: ___________________</div>
                    <div class="py-2">Tarikh: ___________________</div>
                    <div class="py-2">Markah: _______ / 100</div>
                </div>
                <p class="mt-4 text-xs italic">Arahan: Jawab semua soalan. Hitamkan jawapan yang betul.</p>
            </div>
        </div>
    </div>

    <script>
        const units = {
            1: { title: "Kepercayaan Kepada Tuhan", value: "Percaya wujudnya Tuhan" },
            2: { title: "Baik Hati", value: "Membantu orang lain" },
            3: { title: "Bertanggungjawab", value: "Melaksanakan tugas" },
            4: { title: "Berterima Kasih", value: "Menghargai pemberian" },
            5: { title: "Hemah Tinggi", value: "Beradab sopan" },
            6: { title: "Hormat", value: "Menghormati orang lain" },
            7: { title: "Kasih Sayang", value: "Sayang akan keluarga" },
            8: { title: "Keadilan", value: "Bertindak adil" },
            9: { title: "Keberanian", value: "Berani kerana benar" },
            10: { title: "Kejujuran", value: "Bercakap benar" },
            11: { title: "Rajin", value: "Usaha tangga kejayaan" },
            12: { title: "Kerjasama", value: "Melakukan bersama-sama" },
            13: { title: "Kesederhanaan", value: "Tidak keterlaluan" },
            14: { title: "Toleransi", value: "Bertolak ansur" }
        };

        const contexts = {
            1: ["diri sendiri", "rumah", "bilik tidur", "dapur"],
            2: ["keluarga", "rakan sekolah", "padang permainan", "kantin"],
            3: ["warga sekolah", "jiran tetangga", "perpustakaan", "dewan sekolah"]
        };

        const subjects = ["Ali", "Siti", "Ah Meng", "Raju", "Mei Ling", "David", "Aminah", "Sarah", "Chong", "Muthu"];

        let score = 0;
        let answeredCount = 0;
        let currentQuestionsHTML = "";
        let currentFullTitle = "";
        let currentYear = "";

        function generateAIQuestion(yearId, unitId, index) {
            const unit = units[unitId];
            const subject = subjects[index % subjects.length];
            const contextList = contexts[yearId];
            const situation = contextList[index % contextList.length];
            
            const templates = [
                {
                    q: `${subject} melihat sampah di ${situation}. Apakah tindakan yang menunjukkan nilai ${unit.title}?`,
                    correct: `Mengutip dan membuang sampah dengan ${unit.value}`,
                    wrongs: ["Membiarkan sahaja", "Menyepak sampah tersebut", "Menunggu orang lain kutip"]
                },
                {
                    q: `Mengapakah kita perlu mengamalkan sikap ${unit.title} di ${situation}?`,
                    correct: `Supaya suasana di ${situation} menjadi harmoni`,
                    wrongs: ["Supaya dipuji hebat", "Supaya boleh membazir", "Supaya orang takut"]
                },
                {
                    q: `Antara berikut, yang manakah perlakuan ${unit.title} yang betul?`,
                    correct: `Sentiasa bersikap ${unit.value.toLowerCase()}`,
                    wrongs: ["Hanya buat jika disuruh", "Berpura-pura rajin", "Marah apabila diminta bantuan"]
                },
                {
                    q: `Rakan ${subject} meminta bantuan. Sebagai seorang yang ${unit.title}, ${subject} patut...`,
                    correct: `Membantu dengan ikhlas dan sopan`,
                    wrongs: ["Meminta upah wang", "Menolak dengan kasar", "Memberitahu guru untuk denda rakan"]
                }
            ];

            const t = templates[index % templates.length];
            return {
                q: t.q,
                options: shuffleArray([t.correct, ...t.wrongs]),
                ans: t.correct,
                unitTitle: unit.title
            };
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function checkAnswer(btn, isCorrect) {
            const container = btn.closest('.question-container');
            const allOptions = container.querySelectorAll('.option-btn');
            
            allOptions.forEach(opt => opt.classList.add('option-disabled'));
            
            if (isCorrect) {
                btn.classList.add('option-correct');
                score++;
            } else {
                btn.classList.add('option-wrong');
                // Highlight correct one
                allOptions.forEach(opt => {
                    if (opt.dataset.correct === "true") opt.classList.add('option-correct');
                });
            }
            
            answeredCount++;
            document.getElementById('current-score').innerText = score;
            if (answeredCount === 25) {
                document.getElementById('completion-text').innerText = "Tahniah! Anda telah selesai.";
            }
        }

        function createQuestionHTML(index, data) {
            const optionLabels = ['A', 'B', 'C', 'D'];
            let optionsHTML = '';
            
            data.options.forEach((opt, i) => {
                const isCorrect = opt === data.ans;
                optionsHTML += `
                    <div onclick="checkAnswer(this, ${isCorrect})" 
                         data-correct="${isCorrect}"
                         class="option-btn flex items-start gap-3 mb-3 cursor-pointer hover:bg-indigo-50 p-2 rounded-xl border border-transparent transition">
                        <span class="font-bold bg-gray-100 text-gray-700 w-8 h-8 flex items-center justify-center rounded-full border border-gray-300 flex-shrink-0">${optionLabels[i]}</span>
                        <span class="pt-1 text-sm md:text-base">${opt}</span>
                    </div>
                `;
            });

            return `
                <div class="question-container bg-white p-5 rounded-2xl shadow-sm border border-indigo-100 break-inside-avoid">
                    <div class="flex justify-between items-center mb-3 border-b border-gray-100 pb-2">
                        <span class="text-xs font-bold text-gray-400 uppercase">Soalan ${index}</span>
                        <span class="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-1 rounded-full">${data.unitTitle}</span>
                    </div>
                    <p class="text-gray-800 mb-4 font-semibold text-base md:text-lg comic-font">${data.q}</p>
                    <div class="pl-1">${optionsHTML}</div>
                </div>
            `;
        }

        function generatePaper() {
            const yearSel = document.getElementById('yearSelector');
            const unitSel = document.getElementById('unitSelector');
            const selectedYear = parseInt(yearSel.value);
            const selectedUnit = parseInt(unitSel.value);
            
            currentYear = `TAHUN ${selectedYear}`;
            currentFullTitle = `UNIT ${selectedUnit} - ${units[selectedUnit].title.toUpperCase()}`;
            
            score = 0;
            answeredCount = 0;
            document.getElementById('current-score').innerText = "0";
            document.getElementById('stats-bar').classList.remove('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('questions-list').innerHTML = '';
            
            setTimeout(() => {
                let htmlContent = '';
                for (let i = 1; i <= 25; i++) {
                    const qData = generateAIQuestion(selectedYear, selectedUnit, i - 1);
                    htmlContent += createQuestionHTML(i, qData);
                }
                currentQuestionsHTML = htmlContent;
                document.getElementById('questions-list').innerHTML = htmlContent;
                document.getElementById('loading').classList.add('hidden');
            }, 300);
        }

        function openPrintWindow() {
            if (!currentQuestionsHTML) {
                alert("Sila jana soalan terlebih dahulu!");
                return;
            }

            const headerTemplate = document.getElementById('print-header-template').innerHTML;
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = headerTemplate;
            tempDiv.querySelector('.print-subtitle-target').innerText = currentFullTitle;
            tempDiv.querySelector('.print-year-target').innerText = currentYear;
            const finalHeader = tempDiv.innerHTML;

            const win = window.open('', '', 'height=800,width=1000');
            if (win) {
                win.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Cetak Latihan Moral</title>
                        <script src="https://cdn.tailwindcss.com"><\/script>
                        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
                        <style>
                            body { font-family: 'Noto Sans', sans-serif; padding: 20px; }
                            .question-container { border: 1px solid #000; padding: 15px; margin-bottom: 15px; page-break-inside: avoid; border-radius: 5px; }
                            .questions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                            .option-btn { pointer-events: none; border: none !important; }
                            @media print { .no-print { display: none; } .questions-grid { gap: 10px; } }
                        </style>
                    </head>
                    <body>
                        <div class="no-print bg-black text-white p-4 mb-4 flex justify-between rounded">
                            <span class="font-bold">Mod Cetakan</span>
                            <button onclick="window.print()" class="bg-blue-500 px-4 py-1 rounded">Cetak Sekarang</button>
                        </div>
                        ${finalHeader}
                        <div class="questions-grid">${currentQuestionsHTML}</div>
                    </body>
                    </html>
                `);
                win.document.close();
            }
        }

        window.onload = generatePaper;
    </script>
</body>
</html>